angular.module("oi.select",[]);angular.module("oi.select").provider("oiSelect",function(){return{options:{debounce:500,searchFilter:"oiSelectCloseIcon",dropdownFilter:"oiSelectHighlight",listFilter:"oiSelectAscSort",groupFilter:"oiSelectGroup",editItem:!1,newItem:!1,closeList:!0,saveTrigger:"enter tab blur"},version:{full:"0.2.20",major:0,minor:2,dot:20},$get:function(){return{options:this.options,version:this.version}}}}).factory("oiSelectEscape",function(){var n=/[-\/\\^$*+?.()|[\]{}]/g,t="\\$&";return function(i){return String(i).replace(n,t)}}).factory("oiSelectEditItem",function(){return function(n,t,i,r){return r?"":i(n)}}).factory("oiUtils",["$document","$timeout",function(n,t){function i(n,t,i){for(var r=t;r&&r.ownerDocument&&r.nodeType!==11;){if(i){if(r===n)return!1;if(r.className.indexOf(i)>=0)return!0}else if(r===n)return!0;r=r.parentNode}return!1}function u(r,u){function s(n){if(!n||n.target.nodeName==="INPUT"){if(o=!1,e){o=!0;return}t(function(){r.triggerHandler("blur")})}}function h(){f||(f=!0,t(function(){r.triggerHandler("focus")}))}function c(){e=!0}function l(n){e=!1;var c=n.target,h=i(r[0],c);o&&!h&&s();h&&c.nodeName!=="INPUT"&&t(function(){u[0].focus()});!h&&f&&(f=!1)}var f,e,o;n[0].addEventListener("click",l,!0);r[0].addEventListener("mousedown",c,!0);r[0].addEventListener("blur",s,!0);u.on("focus",h);return function(){n[0].removeEventListener("click",l);r[0].removeEventListener("mousedown",c,!0);r[0].removeEventListener("blur",s,!0);u.off("focus",h)}}function f(n,t){var i,f,e,u,o,s;t&&(f=n.offsetHeight,e=c(t,"height","margin"),u=n.scrollTop||0,i=r(t).top-r(n).top+u,o=i,s=i-f+e,i+e>f+u?n.scrollTop=s:i<u&&(n.scrollTop=o))}function s(n,t,i,r,u){function s(n){return parseFloat(u[n])}for(var f=i===(r?"border":"content")?4:t==="width"?1:0,e=0,o=["Top","Right","Bottom","Left"];f<4;f+=2)i==="margin"&&(e+=s(i+o[f])),r?(i==="content"&&(e-=s("padding"+o[f])),i!=="margin"&&(e-=s("border"+o[f]+"Width"))):(e+=s("padding"+o[f]),i!=="padding"&&(e+=s("border"+o[f]+"Width")));return e}function r(n){var t,i,u=n.getBoundingClientRect(),r=n&&n.ownerDocument;if(r)return t=r.documentElement,i=h(r),{top:u.top+i.pageYOffset-t.clientTop,left:u.left+i.pageXOffset-t.clientLeft}}function h(n){return n!=null&&n===n.window?n:n.nodeType===9&&n.defaultView}function c(n,t,i){var r=t==="width"?n.offsetWidth:n.offsetHeight,u=window.getComputedStyle(n,null);if(r<=0||r==null){if(r=u[t],(r<0||r==null)&&(r=n.style[t]),o.test(r))return r;r=parseFloat(r)||0}return r+s(n,t,i||"content",!0,u)}function l(n){for(var t in n)if(n.hasOwnProperty(t)&&n[t].length)return!1;return!0}function a(n){var t=[];return angular.forEach(n,function(n,i){i.toString().charAt(0)!=="$"&&t.push(n)}),t}function v(n,t,i,r,u){for(var e,h,c,o=u?[].concat(n):[],f=0,s=n.length;f<n.length;f++)for(h=i?i(n[f]):n[f],e=0;e<t.length;e++)if(c=r?r(t[e]):t[e],angular.equals(h,c,n,t,f,e)){u?o.splice(f+o.length-s,1):o.push(t[e]);break}return o}function y(n,t,i,r){var u={};return n.split(".").reduce(function(n,i,r,u){return n[i]=r<u.length-1?{}:t},u),r(i,u)}var e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,o=new RegExp("^("+e+")(?!px)[a-z%]+$","i");return{contains:i,bindFocusBlur:u,scrollActiveOption:f,groupsIsEmpty:l,objToArr:a,getValue:y,intersection:v}}]);angular.module("oi.select").directive("oiSelect",["$document","$q","$timeout","$parse","$interpolate","$injector","$filter","$animate","oiUtils","oiSelect",function(n,t,i,r,u,f,e,o,s,h){var c=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,l=/([^\(\)\s\|\s]*)\s*(\(.*\))?\s*(\|?\s*.+)?/;return{restrict:"AE",templateUrl:"src/template.html",require:"ngModel",scope:{},compile:function(n,a){var ft=a.oiOptions,v=ft?ft.match(c):["","i","","","","i","","",""];if(!v)throw new Error("Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_'");var et=/ as /.test(v[0])&&v[1],ot=v[2]||v[1],w=v[5]||v[7],ct=v[3]||"",lt=v[4]||"",at=v[9]||ot,nt=v[8].match(l),tt=nt[1],vt=tt+(nt[3]||""),yt=tt+(nt[2]||""),b=et&&r(et),pt=r(ot),wt=r(ct),bt=r(lt),kt=r(vt),dt=r(yt),gt=r(at),ni=u(a.multiplePlaceholder||""),ti=u(a.placeholder||""),st=r(a.oiSelectOptions),k=angular.version.major<=1&&angular.version.minor<=3,d,it,p,ht,g,y,rt,ut;return function(n,u,c,l){function gi(){lt&&u.removeClass("cleanMode");lt=!1}function nr(n,t){t=t||150;u.addClass(n);i(function(){u.removeClass(n)},t)}function ei(){n.listItemHide=!0;n.inputHide=!1}function ri(){var t=ct(l.$modelValue);n.listItemHide=!t;n.inputHide=t}function fr(t){s.contains(u[0],t.target,"disabled")||n.output.length>=rt&&s.contains(u[0],t.target,"select-dropdown")||(n.inputHide&&n.removeItem(0),n.isOpen&&a.closeList&&(t.target.nodeName!=="INPUT"||!n.query.length)?(ft({query:a.editItem&&!lt}),n.$evalAsync()):fi(n.query))}function er(){n.isFocused||(n.isFocused=!0,c.disabled)||(n.backspaceFocus=!1)}function or(){n.isFocused=!1;y||ri();at("blur")||ft();n.$evalAsync()}function at(r,u){u||(u=r,r=n.query);var o=a.saveTrigger.split(" ").indexOf(u)+1,s=a.newItem&&r,f=u!=="blur"?n.order[n.selectorPosition]:null,e;if(o&&(s||f))return n.showLoader=!0,e=t.when(f||ut(n.$parent,{$query:r})),e.then(function(r){if(r===undefined)return t.reject();n.addItem(r);var u=n.order.length-1;n.selectorPosition===u&&yt(ot,0);a.newItemFn&&!f||i(angular.noop);ft()}).catch(function(){nr("invalid-item");n.showLoader=!1}),!0}function sr(){var n=y&&ct(l.$modelValue)?ur:rr;et.attr("placeholder",n)}function ui(t){return s.getValue(w,t,n.$parent,gt)}function tr(t){return s.getValue(w,t,n.$parent,b)}function vt(t){return s.getValue(w,t,n.$parent,pt)}function hr(t){return s.getValue(w,t,n.$parent,bt)}function oi(t){return s.getValue(w,t,n.$parent,wt)||""}function cr(t){return s.getValue(tt,t,n.$parent,kt)}function ir(n){return n=n instanceof Array?n:n?[n]:[],n.filter(function(n){return n&&(n instanceof Array&&n.length||b||vt(n))})}function ct(n){return!!ir(n).length}function fi(r,f){return p&&ii&&i.cancel(p),p=i(function(){var e=dt(n.$parent,{$query:r,$selectedAs:f})||"";return n.selectorPosition=a.newItem==="prompt"?!1:0,r||f||(n.oldQuery=null),(e.$promise&&!e.$resolved||angular.isFunction(e.then))&&(ii=a.debounce),n.showLoader=!0,t.when(e.$promise||e).then(function(t){if(n.groups={},t&&!f){var i=y?n.output:[],e=pi(s.objToArr(t),r,vt,wi(n.$parent),u),o=s.intersection(e,i,ui,ui,!0),h=cr(o);n.groups=ar(h)}return lr(),t}).finally(function(){n.showLoader=!1;a.closeList&&!a.cleanModel&&i(function(){yt(ot,0)})})},ii)}function lr(){var i,t,u,r=[],f=0;n.order=[];n.groupPos={};for(t in n.groups)n.groups.hasOwnProperty(t)&&t.charAt(0)!="$"&&r.push(t);for(k&&r.sort(),i=0;i<r.length;i++)t=r[i],u=n.groups[t],n.order=n.order.concat(u),n.groupPos[t]=f,f+=u.length}function ft(t){t=t||{};n.oldQuery=null;n.backspaceFocus=!1;n.groups={};n.order=[];n.showLoader=!1;n.isOpen=!1;ii=0;t.query||(n.query="");p&&i.cancel(p)}function yt(t,i){n.selectorPosition=i;s.scrollActiveOption(t[0],t.find("li")[i])}function ar(n){for(var i={"":[]},r,u,t=0;t<n.length;t++)r=oi(n[t]),(u=i[r])||(u=i[r]=[]),u.push(n[t]);return i}var hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di;l.$isEmpty=function(n){return!ct(n)};var et=u.find("input"),ot=angular.element(u[0].querySelector(".select-dropdown")),rr=ti(n),ur=ni(n),si=st(n.$parent)||{},a=angular.extend({cleanModel:si.newItem==="prompt"},h.options,si),nt=a.editItem,lt=nt==="correct",ii=0;(nt===!0||nt==="correct")&&(nt="oiSelectEditItem");hi=nt?f.get(nt):angular.noop;ci=r(a.removeItemFn);v=a.searchFilter.split(":");li=e(v[0]);ai=r(v[1]);v=a.dropdownFilter.split(":");vi=e(v[0]);yi=r(v[1]);v=a.listFilter.split(":");pi=e(v[0]);wi=r(v[1]);v=a.groupFilter.split(":");bi=e(v[0]);ki=r(v[1]);ut=a.newItemFn?r(a.newItemFn):function(n,t){return(st(t)||{}).newItemModel||t.$query};a.cleanModel&&(!nt||lt)&&u.addClass("cleanMode");di=s.bindFocusBlur(u,et);angular.isDefined(c.autofocus)&&i(function(){et[0].focus()});angular.isDefined(c.readonly)&&et.attr("readonly",!0);angular.isDefined(c.tabindex)&&(et.attr("tabindex",c.tabindex),u[0].removeAttribute("tabindex"));a.maxlength&&et.attr("maxlength",a.maxlength);c.$observe("disabled",function(t){et.prop("disabled",t);y&&l.$modelValue&&l.$modelValue.length&&(n.inputHide=t)});n.$on("$destroy",di);n.$parent.$watch(c.multipleLimit,function(n){rt=Number(n)||Infinity});n.$parent.$watch(c.multiple,function(n){y=n===undefined?angular.isDefined(c.multiple):n;u[y?"addClass":"removeClass"]("multiple")});n.$parent.$watch(c.ngModel,function(i,r){var u=ir(i),f=t.when(u);sr();ct(r)&&i!==r&&gi();y||ri();b&&ct(i)&&(f=fi(null,i).then(function(n){return s.intersection(u,n,null,tr)}),p=null);y&&c.disabled&&!ct(i)&&(n.inputHide=!1);f.then(function(t){n.output=t;t.length!==u.length&&n.removeItem(t.length)})});n.$watch("query",function(t,i){at(t.slice(0,-1),t.slice(-1))||(t===i||n.oldQuery&&!t||it||(ot[0].scrollTop=0,t?(fi(t),n.oldQuery=null):y&&(ft(),it=!0)),it=!1)});n.$watch("groups",function(t){s.groupsIsEmpty(t)?n.isOpen=!1:n.isOpen||c.disabled||(n.isOpen=!0,n.isFocused=!0)});n.$watch("isFocused",function(n){o[n?"addClass":"removeClass"](u,"focused",!k&&{tempClasses:"focused-animate"})});n.$watch("isOpen",function(n){o[n?"addClass":"removeClass"](u,"open",!k&&{tempClasses:"open-animate"})});n.$watch("showLoader",function(n){o[n?"addClass":"removeClass"](u,"loading",!k&&{tempClasses:"loading-animate"})});n.addItem=function(t){if(ht=n.query,!y||!s.intersection(n.output,[t],ui,ui).length){if(n.output.length>=rt){nr("limited");return}var r=n.groups[oi(t)]=n.groups[oi(t)]||[],i=b?tr(t):t;r.splice(r.indexOf(t),1);y?l.$setViewValue(angular.isArray(l.$modelValue)?l.$modelValue.concat(i):[i]):(l.$setViewValue(i),ri());s.groupsIsEmpty(n.groups)&&(n.groups={});y||a.closeList||ft({query:!0});gi();n.oldQuery=n.oldQuery||n.query;n.query="";n.backspaceFocus=!1}};n.removeItem=function(i){c.disabled||y&&i<0||(g=y?l.$modelValue[i]:l.$modelValue,t.when(ci(n.$parent,{$item:g})).then(function(){(y||n.inputHide)&&(y?(l.$modelValue.splice(i,1),l.$setViewValue([].concat(l.$modelValue))):(ei(),a.cleanModel&&l.$setViewValue(undefined)),(y||!n.backspaceFocus)&&(n.query=hi(g,ht,vt,lt,u)||""),y&&a.closeList&&ft({query:!0}))}))};n.setSelection=function(t){d||n.selectorPosition===t?d=!1:yt(ot,t)};n.keyUp=function(t){switch(t.keyCode){case 8:n.query.length||y&&n.output.length||ft()}};n.keyDown=function(t){var i=0,r=n.order.length-1;switch(t.keyCode){case 38:n.selectorPosition=angular.isNumber(n.selectorPosition)?n.selectorPosition:i;yt(ot,n.selectorPosition===i?r:n.selectorPosition-1);d=!0;break;case 40:n.selectorPosition=angular.isNumber(n.selectorPosition)?n.selectorPosition:i-1;yt(ot,n.selectorPosition===r?i:n.selectorPosition+1);d=!0;n.query.length||n.isOpen||fi();n.inputHide&&ei();break;case 37:case 39:break;case 9:at("tab");break;case 13:at("enter");t.preventDefault();break;case 32:at("space");break;case 27:y||(ri(),a.cleanModel&&l.$setViewValue(g));ft();break;case 8:if(!n.query.length){if((!y||nt)&&(n.backspaceFocus=!0),n.backspaceFocus&&n.output&&(!y||n.output.length)){n.removeItem(n.output.length-1);nt&&t.preventDefault();break}n.backspaceFocus=!n.backspaceFocus;break}default:return n.inputHide&&ei(),n.backspaceFocus=!1,!1}};n.getSearchLabel=function(t){var i=vt(t);return li(i,n.oldQuery||n.query,t,ai(n.$parent),u)};n.getDropdownLabel=function(t){var i=vt(t);return vi(i,n.oldQuery||n.query,t,yi(n.$parent),u)};n.getGroupLabel=function(t,i){return bi(t,n.oldQuery||n.query,i,ki(n.$parent),u)};n.getDisableWhen=hr;ft();u[0].addEventListener("click",fr,!0);u.on("focus",er);u.on("blur",or)}}}}]);angular.module("oi.select").filter("oiSelectGroup",["$sce",function(n){return function(t){return n.trustAsHtml(t)}}]).filter("oiSelectCloseIcon",["$sce",function(n){return function(t){return n.trustAsHtml(t+'<span class="close select-search-list-item_selection-remove">×<\/span>')}}]).filter("oiSelectHighlight",["$sce","oiSelectEscape",function(n,t){return function(i,r){var u;return r.length>0||angular.isNumber(r)?(i=i.toString(),r=t(r.toString()),u=i.replace(new RegExp(r,"gi"),"<strong>$&<\/strong>")):u=i,n.trustAsHtml(u)}}]).filter("oiSelectAscSort",["oiSelectEscape",function(n){function t(t,i,r,u){var f,e,s,o,h=[],c=[],l=[],a=[];if(i){for(i=n(String(i)),f=0,s=!1;f<t.length;f++){if(s=r(t[f]).match(new RegExp(i,"i")),!s&&u&&(u.length||u.fields))for(e=0;e<u.length;e++){if(s)break;s=String(t[f][u[e]]).match(new RegExp(i,"i"))}s&&h.push(t[f])}for(f=0;f<h.length;f++)r(h[f]).match(new RegExp("^"+i,"i"))?c.push(h[f]):l.push(h[f]);if(o=c.concat(l),u&&(u===!0||u.all)){n:for(f=0;f<t.length;f++){for(e=0;e<o.length;e++)if(t[f]===o[e])continue n;a.push(t[f])}o=o.concat(a)}}else o=[].concat(t);return o}return t}]).filter("none",function(){return function(n){return n}});angular.module("oi.select").run(["$templateCache",function(n){n.put("src/template.html",'<div class=select-search><ul class=select-search-list><li class="btn btn-default btn-xs select-search-list-item select-search-list-item_selection" ng-hide=listItemHide ng-repeat="item in output track by $index" ng-class="{focused: backspaceFocus && $last}" ng-click=removeItem($index) ng-bind-html=getSearchLabel(item)><\/li><li class="select-search-list-item select-search-list-item_input" ng-class="{\'select-search-list-item_hide\': inputHide}"><input autocomplete=off ng-model=query ng-keyup=keyUp($event) ng-keydown=keyDown($event)><\/li><li class="select-search-list-item select-search-list-item_loader" ng-show=showLoader><\/li><\/ul><\/div><div class=select-dropdown ng-show=isOpen><ul ng-if=isOpen class=select-dropdown-optgroup ng-repeat="(group, options) in groups"><div class=select-dropdown-optgroup-header ng-if="group && options.length" ng-bind-html="getGroupLabel(group, options)"><\/div><li class=select-dropdown-optgroup-option ng-init="isDisabled = getDisableWhen(option)" ng-repeat="option in options" ng-class="{\'active\': selectorPosition === groupPos[group] + $index, \'disabled\': isDisabled, \'ungroup\': !group}" ng-click="isDisabled || addItem(option)" ng-mouseenter="setSelection(groupPos[group] + $index)" ng-bind-html=getDropdownLabel(option)><\/li><\/ul><\/div>')}]);
//# sourceMappingURL=select.min.js.map
